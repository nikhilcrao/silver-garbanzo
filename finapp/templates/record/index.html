{% extends "base.html" %}

{% from "bootstrap5/form.html" import render_form %}
{% from "bootstrap5/table.html" import render_table %}
{% from 'bootstrap5/pagination.html' import render_pagination %}

{% block title %}Records{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="row justify-content-center mt-2">
    <div class="col-md">
      <h2>Records</h2>
      {{ render_form(form,
                     action='/record/',
                     method='GET',
                     form_type='horizontal') }}
    </div>
  </div>
  <div class="row justify-content-center mt-2">
    <div class="col-md">
      {{ render_table(records,
                      titles=[
                        ('id', '#'),
                        ('date', 'Date'),
                        ('description', 'Description'),
                        ('amount', 'Amount'),
                        ('category_id', 'Category'),
                        ('merchant_id', 'Merchant'),
                      ],
                      show_actions=True,
                      custom_actions=[
                        ('New Rule', 'file-ruled', ('rule.add', [('keywords', ':description')])),
                      ],
                      model=Record,
                      edit_url=('record.edit', [('id', ':id'), ('next', request.path)]),
                      new_url='record.add') }}
      {{ render_pagination(records, **args) }}
    </div>
  </div>
</div>
{% endblock %}

{% block content2 %}
<div class="container">
  <div class="row">
    <div class="row">
      <a href="{{ url_for('record.index') }}">All Records</a>
    </div>
    <div class="row">
      <a href="{{ url_for('record.index', category_id=0) }}">Uncategorized</a>
    </div>
  </div>

  <form method="GET" action="{{ url_for('record.index') }}">
  <div class="row">
    <div class="col">
      <input type="text" name="search" placeholder="Search"/>
    </div>
    <div class="col">
      <input type="submit" value="Search"/>
    </div>
  </div>
  </form>
  
  <div class="table-responsive">
    <table class="table table-sm table-borderless mb-0">
      <thead class="thead-dark">
        <tr>
          <th>#</th>
          <th>Transaction Date</th>
          <th>Description</th>
          <th>Amount</th>
          <th>Category</th>
          <th>Merchant</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        {% set record, merchant, category = item[0], item[1], item[2] %}
        <tr>
          <th scope="row">{{ loop.index + (items.page - 1) * items.per_page }}</th>
          <td>{{ record.date }}</td>
          <td>{{ record.description }}</td>
          <td>{{ record.amount }}</td>
          <td>{{ category.name if category.name is defined else '' }}</td>
          <td>{{ merchant.name if merchant.name is defined else '' }}</td>
          <td>
            <a href="{{ url_for('record.edit', id=record.id) }}" class="btn btn-primary">Edit</a>
            <a href="{{ url_for('record.delete', id=record.id) }}" class="btn btn-danger">Delete</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {{ render_pagination(items, 'record.index') }}
</div>
{% endblock %}